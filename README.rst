Internet Archive PDF tools
##########################

:authors: - Merlijn Wajer <merlijn@archive.org>
:date: 2020-11-19 11:00

This repository contains a library to perform MRC (Mixed Raster Content)
compression on images [*]_, which offers lossy high compression of images, in
particular images with text.

Additionally, the library can generate MRC-compressed PDF files with hOCR [*]_
text layers mixed into to the PDF, which makes searching and copy-pasting of the
PDF possible. PDFs generated by `bin/recode_pdf` should be `PDF/A 3b` and
`PDF/UA` compatible.

Some of the tooling also supports specific Internet Archive file formats (such
as the "scandata.xml" files, but the tooling should work fine without those
files, too.

While the code is already being used internally to create PDFs at the Internet
Archive, the code still needs more documentation and cleaning up, so don't
expect this to be super well documented just yet.

Dependencies
============

* Python 3.x
* Python packages (also see `requirements.txt`):
    - PyMuPDF
    - lxml
    - scikit-image
    - Pillow
    - roman
    - `archive-hocr-tools <https://git.archive.org/merlijn/archive-hocr-tools>`_

* `Kakadu JPEG2000 binaries <https://kakadusoftware.com/>`_ (OpenJPEG2000 support planned)

Optional:

* For JBIG2 support, a (currently unreleased) version of mupdf is required.
  mupdf 1.19 is expected to fully support JBIG2. (PyMuPDF currently packages
  mupdf statically, so you'll have to make sure that version is also up to
  date). The default PDF compression options use ``ccitt``, so this is only
  required if you pass ``--jbig2`` to ``bin/pdf_recode``.


Features
========

* MRC compression of images, leading to anywhere from 3-15x compression ratios,
  depending on the quality setting provided.
* Creates PDF from a directory of images
* Improved compression based on OCR results (hOCR files)
* Hidden text layer insertion based on hOCR files, which makes a PDF searchable
  and the text copy-pasteable.
* PDF/A 3b compatible.
* Basic PDF/UA support (accessibility features)



Not well tested features
========================

* "Recoding" an existing PDF, extracting the images and creating a new PDF with
  the images from the existing PDF is not well tested.


Planned features
================

* Support for OpenJPEG2000 for image encoding
* Support for using JPEG instead of JPEG2000
* Support for optional denoising of masks to further improve compression
* Addition of a second set of fonts in the PDFs, so that hidden selected text
  also renders the original glyphs.


License
=======

License for all code (minus ``internetarchive/pdfrenderer.py``) is AGPL 3.0.

``internetarchive/pdfrenderer.py`` is Apache 2.0, which matches the Tesseract
license for that file.


.. [*] https://en.wikipedia.org/wiki/Mixed_raster_content
.. [*] http://kba.cloud/hocr-spec/1.2/

